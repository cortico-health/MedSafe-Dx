services:
  converter:
    build: .
    volumes:
      - ./data:/app/data
      - ./results:/app/results
    user: "1000:1000"
    command: python data/cases.py
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1

  inference:
    build: .
    volumes:
      - ./data:/app/data
      - ./results:/app/results
      - ./inference:/app/inference
    user: "1000:1000"
    env_file:
      - .env.local
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    # Override command at runtime

  evaluator:
    build: .
    volumes:
      - ./data:/app/data
      - ./results:/app/results
      - ./evaluator:/app/evaluator
      - ./scripts:/app/scripts
    user: "1000:1000"
    env_file:
      - .env.local
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    # Override command at runtime

  web:
    build: ./web
    ports:
      - "${WEB_PORT:-18080}:8000"
    volumes:
      - ./leaderboard:/app/leaderboard
      - ./README.md:/app/README.md
      - ./web/main.py:/app/main.py
      - ./web/static:/app/static
    environment:
      - PYTHONUNBUFFERED=1

  latex:
    image: texlive/texlive:latest
    volumes:
      - ./results/analysis:/workdir
    working_dir: /workdir
    command: pdflatex -interaction=nonstopmode paper_tables.tex

  rag-evaluator:
    build: .
    network_mode: "host"
    volumes:
      - ./data:/app/data
      - ./results:/app/results
      - ./evaluator:/app/evaluator
      - ./scripts:/app/scripts
    env_file:
      - .env.local
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
